<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MonBailZen ‚Äî v7.2 (maxi)</title>
<style>
:root{--bg:#0e1014;--panel:#151b22;--soft:#10141c;--text:#e6edf3;--muted:#9aa6b2;
--gold:#bfc86f;--accent:#66a8ff;--ok:#36d399;--warn:#fbbd23;--err:#ef4444;--line:#273145}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:#0b0f15;color:var(--text);font:15px/1.55 Inter,system-ui,Segoe UI,Roboto,Arial}
.wrap{max-width:1200px;margin:0 auto;padding:16px}
.top{position:sticky;top:0;background:#0c1017e6;backdrop-filter:blur(8px);z-index:30;border-bottom:1px solid var(--line)}
.brand{display:flex;gap:10px;align-items:center;justify-content:space-between}
.logo{width:46px;height:46px;border-radius:12px;display:grid;place-items:center;font-weight:900;
border:1px solid #2c364a;background:linear-gradient(135deg,#29354a,#1b2436);color:#fff}
.title{font-size:18px}
.badge{display:inline-flex;gap:6px;align-items:center;font-size:12px;padding:3px 8px;border-radius:20px;border:1px solid var(--line);background:#121826}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.tab{cursor:pointer;padding:9px 14px;border-radius:999px;border:1px solid var(--line);background:#121826;color:var(--text)}
.tab.active{background:linear-gradient(135deg,#2f3a50,#1e2638);color:#fff;border-color:#41506a}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #30394b;background:#1b2231;color:#fff;text-decoration:none;font-weight:600}
.btn.gold{background:linear-gradient(135deg,#c9d67b,#94a24c);color:#111;border:none}
.btn.ghost{background:transparent}
.grid{display:grid;gap:16px}
@media(min-width:900px){.grid.cols-2{grid-template-columns:1fr 1fr}.grid.cols-3{grid-template-columns:repeat(3,1fr)}.grid.cols-4{grid-template-columns:repeat(4,1fr)}}
.card{background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:16px}
.card h3{margin:0 0 10px;font-size:18px}
hr.sep{border:none;border-top:1px dashed var(--line);margin:20px 0}
.kv{display:grid;grid-template-columns:170px 1fr;gap:6px 12px}
.kv label{color:var(--muted)}
input,select,textarea{width:100%;background:#0f1420;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}
input[type="date"],input[type="month"]{padding:8px 10px}
.small{font-size:12px;color:var(--muted)}
.right{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:#0f1420;border:1px solid var(--line);color:#cbd5e1;padding:4px 10px;border-radius:999px;font-size:12px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #223047;text-align:left}
tfoot td{font-weight:700}
.notice{padding:10px;border:1px solid var(--line);background:#0f1420;border-radius:12px}
.ok{color:var(--ok)}.warn{color:var(--warn)}.err{color:var(--err)}
.pill{display:inline-block;padding:3px 8px;border-radius:6px;background:#0f1420;border:1px solid var(--line);font-size:12px}
.footer{margin:28px 0;color:#9aa6b2;font-size:12px;text-align:center}
/* Modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0008;z-index:99}
.modal.open{display:flex}
.modal .box{width:min(820px,92vw);background:#151b24;border:1px solid var(--line);border-radius:16px;padding:16px}
.modal header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.canvas{background:#fff;height:280px;border-radius:8px}
/* thumbnails */
.thumb{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;margin:4px 6px 0 0;font-size:12px;border:1px solid var(--line);border-radius:8px;background:#0f1420}
.hidden{display:none!important}
.center{display:grid;place-items:center}
.hero{padding:30px;border:1px dashed var(--line);border-radius:16px;background:linear-gradient(180deg,#101625,#0f1420)}
.price{font-size:28px;font-weight:800}
</style>
</head>
<body>
<header class="top">
  <div class="wrap nav">
    <div class="brand">
      <div class="logo">MBZ</div>
      <div class="title">MonBailZen <span class="badge">v7.2</span></div>
    </div>
    <nav class="tabs" id="site-tabs">
      <button class="tab active" data-tab="home">Accueil</button>
      <button class="tab" data-tab="features">Fonctionnalit√©s</button>
      <button class="tab" data-tab="lease">Baux</button>
      <button class="tab" data-tab="edl">√âtats des lieux</button>
      <button class="tab" data-tab="quittance">Quittance</button>
      <button class="tab" data-tab="pricing">Tarifs</button>
      <button class="tab" data-tab="faq">FAQ</button>
      <button class="tab" data-tab="contact">Contact</button>
      <a class="btn gold" id="open-demo">Essayer la d√©mo</a>
    </nav>
  </div>
</header>

<!-- ACCUEIL / VITRINE -->
<main class="wrap" id="home" data-view>
  <div class="grid cols-2">
    <section class="card hero">
      <h2>G√©rez vos locations en toute s√©r√©nit√©</h2>
      <p class="small">Baux guid√©s, EDL multi-pi√®ces + photos, signatures (d√©mo), IRL, compta mensuelle & annuelle, exports PDF/CSV.</p>
      <div class="chips">
        <span class="chip">‚Äì70% temps de gestion</span><span class="chip">ALUR ‚Ä¢ ELAN ‚Ä¢ eIDAS (d√©mo)</span>
        <span class="chip">PDF + CSV</span><span class="chip">4,8/5</span>
      </div>
      <hr class="sep">
      <div class="right">
        <a class="btn gold" id="cta-demo">D√©marrer la d√©mo</a>
        <a class="btn ghost" data-tabto="features">Voir les fonctionnalit√©s</a>
      </div>
    </section>
    <section class="card">
      <h3>Pourquoi MonBailZen ?</h3>
      <ul class="small">
        <li>Formulaires guid√©s bailleur / locataire / garant, clauses et annexes</li>
        <li>EDL multi-pi√®ces (murs, sols, plafonds, menuiseries, √©lectricit√©, appareils), photos, anomalies, commentaires</li>
        <li>IRL, quittances & rappels (d√©mo), compta simple, bilan, CSV</li>
        <li>D√©mo 100% locale (localStorage), impression PDF (Ctrl/Cmd+P)</li>
      </ul>
      <div class="notice small">Cette d√©mo n‚Äôutilise pas de serveur : tout est simul√© c√¥t√© navigateur.</div>
    </section>
  </div>
</main>

<!-- FONCTIONNALIT√âS (r√©cap) -->
<main class="wrap hidden" id="features" data-view>
  <div class="grid cols-3">
    <section class="card center"><div>
      <h3>Baux guid√©s</h3><p class="small">Vide, Meubl√©, Colocation, Mobilit√©. Dur√©e, d√©p√¥t, indexation IRL, clauses & annexes.</p>
      <a class="btn" data-tabto="lease">Ouvrir les baux</a>
    </div></section>
    <section class="card center"><div>
      <h3>√âtat des lieux</h3><p class="small">Entr√©e/Sortie, pi√®ces illimit√©es, photos & anomalies, signature (d√©mo).</p>
      <a class="btn" data-tabto="edl">Ouvrir EDL</a>
    </div></section>
    <section class="card center"><div>
      <h3>Comptabilit√©</h3><p class="small">Saisies libres, totaux auto, export CSV.</p>
      <a class="btn" data-tabto="lease">Voir</a>
    </div></section>
  </div>
</main>

<!-- BAUX (COMPLET) + COMPTA + IRL -->
<main class="wrap hidden" id="lease" data-view>
  <div class="grid cols-2">
    <section class="card">
      <h3>Bail ‚Äî Informations</h3>
      <div class="kv">
        <label>Type de bail</label>
        <select id="b_type">
          <option>Vide</option><option>Meubl√©</option><option>Colocation</option><option>Mobilit√©</option>
        </select>

        <label>Adresse du bien</label><input id="b_addr" placeholder="4 rue Exemple, 75000 Paris">
        <label>Surface (m¬≤)</label><input id="b_area" type="number" value="45">
        <label>Loyer HC (‚Ç¨)</label><input id="b_rent" type="number" value="650">
        <label>Charges (‚Ç¨)</label><input id="b_chg" type="number" value="50">
        <label>D√©p√¥t de garantie (‚Ç¨)</label><input id="b_dep" type="number" value="650">
        <label>Dur√©e</label>
        <select id="b_term">
          <option>3 ans (vide)</option><option>1 an (meubl√©)</option><option>9 mois (mobilit√©)</option><option>Autre</option>
        </select>
        <label>Autre dur√©e (si ‚ÄúAutre‚Äù)</label><input id="b_term_custom" placeholder="ex. 24 mois">

        <label>Locataire</label><input id="b_tenant" placeholder="Pr√©nom NOM">
        <label>Garant</label><input id="b_guarantor" placeholder="(facultatif)">
        <label>Date d‚Äôeffet</label><input id="b_start" type="date">
        <label>Pr√©avis</label>
        <select id="b_notice"><option>3 mois</option><option>1 mois (zone tendue)</option></select>

        <label>Indexation IRL</label>
        <select id="b_irl_m"><option>Anniversaire du bail</option><option>Janvier</option><option>Avril</option><option>Juillet</option><option>Octobre</option></select>
        <label>IRL de r√©f√©rence</label><input id="b_irl" type="number" step="0.01" value="143.15">
      </div>

      <hr class="sep">
      <div id="meuble_block" class="notice small hidden">
        <b>Inventaire (meubl√©)</b> ‚Äî Liste rapide :
        <div class="chips" id="inv_meuble">
          <label class="chip"><input type="checkbox" checked> Literie</label>
          <label class="chip"><input type="checkbox" checked> Plaques cuisson</label>
          <label class="chip"><input type="checkbox" checked> Four/Micro-ondes</label>
          <label class="chip"><input type="checkbox" checked> R√©frig√©rateur</label>
          <label class="chip"><input type="checkbox" checked> Vaisselle</label>
          <label class="chip"><input type="checkbox" checked> Table & chaises</label>
          <label class="chip"><input type="checkbox" checked> Rangement</label>
          <label class="chip"><input type="checkbox" checked> Luminaire</label>
        </div>
      </div>

      <hr class="sep">
      <div class="kv">
        <label>Clauses</label>
        <div>
          <label class="chip"><input type="checkbox" id="cl_index" checked> Indexation IRL</label>
          <label class="chip"><input type="checkbox" id="cl_entret" checked> Entretien courant</label>
          <label class="chip"><input type="checkbox" id="cl_caution"> Caution solidaire</label>
          <label class="chip"><input type="checkbox" id="cl_animaux"> Animaux</label>
        </div>
        <label>Annexes</label>
        <div>
          <label class="chip"><input type="checkbox" id="ax_dpe" checked> DPE</label>
          <label class="chip"><input type="checkbox" id="ax_erp" checked> ERP</label>
          <label class="chip"><input type="checkbox" id="ax_plomb" checked> Plomb (si avant 1949)</label>
          <label class="chip"><input type="checkbox" id="ax_amiante"> Amiante (si applicable)</label>
        </div>
      </div>

      <div class="right" style="margin-top:10px">
        <button class="btn" id="b_gen">Aper√ßu bail</button>
        <button class="btn ghost" id="b_pdf">PDF (d√©mo)</button>
        <button class="btn ghost" id="b_sign">Signature (d√©mo)</button>
      </div>
      <hr class="sep"><div id="b_preview" class="small"></div>
    </section>

    <section class="card">
      <h3>Comptabilit√© (d√©mo)</h3>
      <div class="kv">
        <label>Mois</label><input id="acc_month" type="month">
        <label>Loyer encaiss√© (‚Ç¨)</label><input id="acc_rent" type="number" value="0">
        <label>Charges encaiss√©es (‚Ç¨)</label><input id="acc_chg" type="number" value="0">
        <label>D√©penses (‚Ç¨)</label><input id="acc_sp" type="number" value="0">
      </div>
      <div class="right" style="margin-top:10px">
        <button class="btn" id="acc_save">Enregistrer</button>
        <button class="btn ghost" id="acc_csv">Export CSV</button>
      </div>
      <hr class="sep">
      <table id="acc_table"><thead><tr><th>Mois</th><th>Loyer</th><th>Charges</th><th>D√©penses</th><th>Solde</th></tr></thead><tbody></tbody><tfoot><tr><td>Total</td><td id="t_rent">0</td><td id="t_chg">0</td><td id="t_sp">0</td><td id="t_bal">0</td></tr></tfoot></table>

      <hr class="sep">
      <h3>IRL (r√©vision loyer)</h3>
      <div class="kv">
        <label>IRL N-1</label><input id="irl_prev" type="number" step="0.01" value="138.61">
        <label>IRL N</label><input id="irl_now" type="number" step="0.01" value="143.15">
        <label>Loyer actuel (‚Ç¨)</label><input id="irl_rent" type="number" value="650">
      </div>
      <div class="right" style="margin-top:10px"><button class="btn" id="irl_calc">Calculer</button></div>
      <div id="irl_out" class="notice small" style="margin-top:8px"></div>
    </section>
  </div>
</main>

<!-- EDL AVANC√â -->
<main class="wrap hidden" id="edl" data-view>
  <div class="grid cols-2">
    <section class="card">
      <h3>√âtat des lieux</h3>
      <div class="kv">
        <label>Type</label><select id="edl_type"><option>Entr√©e</option><option>Sortie</option></select>
        <label>Ajouter une pi√®ce</label>
        <select id="edl_add_room">
          <option value="">‚Äî choisir ‚Äî</option>
          <option>Salon</option><option>Chambre</option><option>Cuisine</option><option>Salle de bain</option>
          <option>WC</option><option>Entr√©e</option><option>Balcon</option><option>Cave</option>
        </select>
      </div>
      <div id="rooms" class="grid" style="margin-top:10px"></div>
      <div class="right" style="margin-top:10px">
        <button class="btn" id="edl_sign">Signature (d√©mo)</button>
        <button class="btn ghost" id="edl_pdf">PDF (d√©mo)</button>
      </div>
    </section>

    <section class="card">
      <h3>Astuces</h3>
      <p class="small">Ajoutez autant de pi√®ces que n√©cessaire. Pour chaque pi√®ce, cochez l‚Äô√©tat des √©l√©ments, joignez des photos (noms list√©s) et notez vos commentaires.</p>
      <div class="notice small">Cette EDL de d√©mo stocke les infos en localStorage.</div>
    </section>
  </div>
</main>

<!-- QUITTANCE -->
<main class="wrap hidden" id="quittance" data-view>
  <div class="grid cols-2">
    <section class="card">
      <h3>G√©n√©rer une quittance</h3>
      <div class="kv">
        <label>P√©riode</label><input id="q_month" type="month">
        <label>Nom locataire</label><input id="q_tenant" placeholder="Pr√©nom NOM">
        <label>Adresse logement</label><input id="q_addr" placeholder="Adresse compl√®te">
        <label>Loyer HC (‚Ç¨)</label><input id="q_rent" type="number" value="650">
        <label>Charges (‚Ç¨)</label><input id="q_chg" type="number" value="50">
        <label>Ville & date</label><input id="q_city" placeholder="Paris, le ‚Ä¶">
      </div>
      <div class="right" style="margin-top:10px">
        <button class="btn" id="q_make">Aper√ßu</button>
        <button class="btn ghost" id="q_print">Imprimer / PDF</button>
      </div>
      <hr class="sep"><div id="q_out" class="small"></div>
    </section>

    <section class="card">
      <h3>Mentions</h3>
      <p class="small">La quittance atteste du paiement int√©gral des sommes dues pour la p√©riode indiqu√©e (loyer + charges). Impression possible via votre navigateur (PDF).</p>
    </section>
  </div>
</main>

<!-- TARIFS -->
<main class="wrap hidden" id="pricing" data-view>
  <section class="card">
    <h3>Tarifs</h3>
    <div class="grid cols-3">
      <div class="card"><h3>Starter</h3><p class="small">1 bien</p><p class="price ok">0‚Ç¨</p><button class="btn gold">Essayer</button></div>
      <div class="card"><h3>Pro</h3><p class="small">Jusqu‚Äô√† 10 biens</p><p class="price ok">9‚Ç¨</p><button class="btn gold">Choisir</button></div>
      <div class="card"><h3>Business</h3><p class="small">Illimit√©</p><p class="price ok">19‚Ç¨</p><button class="btn gold">Choisir</button></div>
    </div>
  </section>
</main>

<!-- FAQ -->
<main class="wrap hidden" id="faq" data-view>
  <section class="card">
    <h3>FAQ</h3>
    <p><span class="pill">Donn√©es</span> D√©mo 100% locale (localStorage). Pas de serveur.</p>
    <p><span class="pill">Signature</span> Simulation eIDAS pour la d√©mo (canvas).</p>
    <p><span class="pill">PDF</span> Utilisez l‚Äôimpression du navigateur (Ctrl/Cmd+P).</p>
  </section>
</main>

<!-- CONTACT -->
<main class="wrap hidden" id="contact" data-view>
  <section class="card">
    <h3>Contact</h3>
    <div class="kv">
      <label>Nom</label><input id="c_name">
      <label>Email</label><input id="c_mail" type="email">
      <label>Message</label><textarea id="c_msg" rows="4"></textarea>
    </div>
    <div class="right" style="margin-top:10px"><button class="btn" id="c_send">Envoyer (d√©mo)</button></div>
    <div id="c_out" class="small" style="margin-top:8px"></div>
  </section>
</main>

<!-- MODAL SIGNATURE -->
<div id="sig_modal" class="modal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true" aria-labelledby="sig_t">
    <header>
      <strong id="sig_t">Signature (d√©mo)</strong>
      <button class="btn ghost" id="sig_close">Fermer</button>
    </header>
    <canvas id="sig_pad" class="canvas"></canvas>
    <div class="right" style="margin-top:10px">
      <button class="btn ghost" id="sig_clear">Effacer</button>
      <button class="btn" id="sig_save">Enregistrer</button>
    </div>
  </div>
</div>

<footer class="footer wrap">¬© 2025 MonBailZen ‚Äî D√©mo front-end autonome. Donn√©es locales. eIDAS simul√©e.</footer>

<script>
/* ====== Utilitaires ====== */
const $ = s=>document.querySelector(s);
const $$ = s=>document.querySelectorAll(s);
const views=[...$$('[data-view]')], tabs=[...$$('.tab')];
const eur = n => (Number(n)||0).toLocaleString('fr-FR',{style:'currency',currency:'EUR'});
function show(id){ views.forEach(v=>v.classList.toggle('hidden',v.id!==id)); tabs.forEach(t=>t.classList.toggle('active',t.dataset.tab===id)); location.hash='#'+id; }
tabs.forEach(t=>t.addEventListener('click',()=>show(t.dataset.tab)));
$$('[data-tabto]').forEach(a=>a.addEventListener('click',()=>show(a.getAttribute('data-tabto'))));
addEventListener('load',()=>{const h=location.hash.replace('#','')||'home'; if($('#'+h)) show(h);});
addEventListener('hashchange',()=>{const h=location.hash.replace('#',''); if($('#'+h)) show(h);});

/* ====== Signature modal ====== */
const modal=$('#sig_modal'), btnOpenDemo=$('#open-demo'), btnCtaDemo=$('#cta-demo');
const btnSigClose=$('#sig_close'), btnSigClear=$('#sig_clear'), btnSigSave=$('#sig_save');
let pad, ctx, drawing=false, last;
function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); resizePad(); }
function closeModal(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }
function outside(e){ if(e.target===modal) closeModal(); }
function esc(e){ if(e.key==='Escape') closeModal(); }
[btnOpenDemo,btnCtaDemo].forEach(b=>b&&b.addEventListener('click',()=>{ show('features'); openModal(); }));
btnSigClose.addEventListener('click',closeModal); modal.addEventListener('click',outside); document.addEventListener('keydown',esc);
function resizePad(){ pad=$('#sig_pad'); const dpr=Math.max(1,devicePixelRatio||1), r=pad.getBoundingClientRect();
  pad.width=r.width*dpr; pad.height=r.height*dpr; ctx=pad.getContext('2d'); ctx.scale(dpr,dpr); ctx.lineWidth=2; ctx.lineCap='round';
  ctx.fillStyle="#fff"; ctx.fillRect(0,0,r.width,r.height);}
function P(e){ const r=pad.getBoundingClientRect(); const t=(e.touches?e.touches[0]:e); return {x:t.clientX-r.left,y:t.clientY-r.top}; }
function down(e){ drawing=true; last=P(e);} function move(e){ if(!drawing)return; const p=P(e); ctx.beginPath(); ctx.moveTo(last.x,last.y); ctx.lineTo(p.x,p.y); ctx.stroke(); last=p;}
function up(){ drawing=false;}
['mousedown','touchstart'].forEach(ev=>document.addEventListener(ev,ev.startsWith('touch')?e=>pad.contains(e.target)&&down(e):e=>pad.contains(e.target)&&down(e)));
['mousemove','touchmove'].forEach(ev=>document.addEventListener(ev,move));
['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>document.addEventListener(ev,up));
btnSigClear.addEventListener('click',resizePad);
btnSigSave.addEventListener('click',()=>{ try{ localStorage.setItem('mbz_sig', pad.toDataURL()); alert('Signature enregistr√©e (d√©mo)'); closeModal(); }catch(e){ alert('Sauvegarde locale impossible'); }});

/* ====== Baux ====== */
const bType=$('#b_type'); const meubleBlock=$('#meuble_block');
bType.addEventListener('change',()=>{meubleBlock.classList.toggle('hidden',bType.value!=='Meubl√©');});
function bailData(){
  const get=v=>$('#'+v).value;
  const inv=[...$('#inv_meuble').querySelectorAll('input:checked')].map(x=>x.parentElement.textContent.trim());
  return {
    type:get('b_type'), addr:get('b_addr'), area:+get('b_area')||0, rent:+get('b_rent')||0, chg:+get('b_chg')||0, dep:+get('b_dep')||0,
    term:get('b_term')==='Autre'?get('b_term_custom')||'‚Äî':get('b_term'),
    tenant:get('b_tenant')||'[Locataire]', guar:get('b_guarantor')||'', start:get('b_start')||'[date]', notice:get('b_notice'),
    irl_m:get('b_irl_m'), irl:+get('b_irl')||0, inv,
    cl:{index:$('#cl_index').checked, entret:$('#cl_entret').checked, caution:$('#cl_caution').checked, animaux:$('#cl_animaux').checked},
    ax:{dpe:$('#ax_dpe').checked, erp:$('#ax_erp').checked, plomb:$('#ax_plomb').checked, amiante:$('#ax_amiante').checked}
  };
}
function bailPreview(){
  const b=bailData(); const total=b.rent+b.chg;
  const clauses=[ b.cl.index&&'Indexation IRL', b.cl.entret&&'Entretien courant', b.cl.caution&&'Caution solidaire', b.cl.animaux&&'Animaux' ].filter(Boolean).join(' ‚Ä¢ ')||'‚Äî';
  const annexes=[ b.ax.dpe&&'DPE', b.ax.erp&&'ERP', b.ax.plomb&&'Plomb', b.ax.amiante&&'Amiante' ].filter(Boolean).join(' ‚Ä¢ ')||'‚Äî';
  const inv = (b.type==='Meubl√©' && b.inv.length)? `<br>Inventaire (extrait) : ${b.inv.join(', ')}` : '';
  $('#b_preview').innerHTML =
  `<div class="notice">
    <b>Bail ${b.type}</b> ‚Äî ${b.area} m¬≤ ‚Äî ${b.addr}<br>
    Locataire : ${b.tenant}${b.guar?` ‚Äî Garant : ${b.guar}`:''}<br>
    Loyer HC : ${eur(b.rent)} ‚Ä¢ Charges : ${eur(b.chg)} ‚Ä¢ <b>Total : ${eur(total)}</b><br>
    D√©p√¥t : ${eur(b.dep)} ‚Ä¢ Dur√©e : ${b.term} ‚Ä¢ Pr√©avis : ${b.notice}<br>
    IRL r√©f. : ${b.irl} ‚Äî R√©vision : ${b.irl_m}<br>
    Clauses : ${clauses}<br>
    Annexes : ${annexes}${inv}<br>
    Date d‚Äôeffet : ${b.start}
  </div>`;
  try{ localStorage.setItem('mbz_bail', JSON.stringify(b)); }catch{}
}
$('#b_gen').addEventListener('click', bailPreview);
$('#b_pdf').addEventListener('click',()=>window.print());
$('#b_sign').addEventListener('click', openModal);

/* ====== Comptabilit√© ====== */
const accTBody=$('#acc_table tbody');
function refreshAcc(){
  const items=JSON.parse(localStorage.getItem('mbz_acc')||'[]'); accTBody.innerHTML=''; let tr=0,tc=0,ts=0;
  for(const it of items){const bal=(+it.rent)+(+it.chg)-(+it.sp);
    tr+=+it.rent; tc+=+it.chg; ts+=+it.sp;
    const trEl=document.createElement('tr'); trEl.innerHTML=`<td>${it.month}</td><td>${eur(it.rent)}</td><td>${eur(it.chg)}</td><td>${eur(it.sp)}</td><td>${eur(bal)}</td>`; accTBody.appendChild(trEl);
  }
  $('#t_rent').textContent=eur(tr); $('#t_chg').textContent=eur(tc); $('#t_sp').textContent=eur(ts); $('#t_bal').textContent=eur(tr+tc-ts);
}
$('#acc_save').addEventListener('click',()=>{ const m=$('#acc_month').value||'[mois]'; const r=+$('#acc_rent').value||0; const c=+$('#acc_chg').value||0; const s=+$('#acc_sp').value||0;
  const items=JSON.parse(localStorage.getItem('mbz_acc')||'[]'); items.push({month:m,rent:r,chg:c,sp:s}); localStorage.setItem('mbz_acc',JSON.stringify(items)); refreshAcc(); });
$('#acc_csv').addEventListener('click',()=>{ const items=JSON.parse(localStorage.getItem('mbz_acc')||'[]');
  const rows=[['Mois','Loyer','Charges','D√©penses','Solde'], ...items.map(it=>[it.month,it.rent,it.chg,it.sp,(+it.rent+ +it.chg- +it.sp)])];
  const csv=rows.map(r=>r.join(';')).join('\n'); const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv;charset=utf-8'})); a.download='compta.csv'; a.click();});
refreshAcc();

/* ====== IRL ====== */
$('#irl_calc').addEventListener('click',()=>{ const p=+$('#irl_prev').value||0, n=+$('#irl_now').value||0, r=+$('#irl_rent').value||0;
  if(!p||!n||!r){ $('#irl_out').textContent='Renseignez IRL N-1, IRL N et Loyer.'; return; }
  const coef=n/p, nv=(r*coef).toFixed(2); $('#irl_out').innerHTML=`Coefficient : <b>${coef.toFixed(4)}</b> ‚Äî Loyer r√©vis√© : <b>${eur(nv)}</b>`; });

/* ====== EDL ====== */
const roomsBox=$('#rooms');
$('#edl_add_room').addEventListener('change', e=>{
  const name=e.target.value; if(!name) return; e.target.value='';
  const el=document.createElement('div'); el.className='card';
  el.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <b>${name}</b>
      <button class="btn ghost" data-del>Supprimer</button>
    </div>
    <div class="grid cols-3">
      ${['Murs','Sols','Plafond','Menuiseries','√âlectricit√©','Appareils','Chauffage','Fen√™tres'].map(k=>`
        <label class="small">${k}<br>
          <select data-k="${k}">
            <option>OK</option><option>√Ä nettoyer</option><option>√Ä r√©parer</option><option>Remplacer</option>
          </select>
        </label>`).join('')}
    </div>
    <div style="margin-top:8px" class="grid cols-2">
      <div>
        <label class="small">Photos (√©tat)</label>
        <input type="file" accept="image/*" multiple data-photos>
        <div class="small" data-prev></div>
      </div>
      <div>
        <label class="small">Anomalies (photos)</label>
        <input type="file" accept="image/*" multiple data-issues>
        <div class="small" data-prev-issues></div>
      </div>
    </div>
    <label class="small" style="display:block;margin-top:8px">Commentaires</label>
    <textarea rows="2" placeholder="Observations‚Ä¶"></textarea>
  `;
  roomsBox.appendChild(el);
  el.querySelector('[data-del]').onclick=()=>el.remove();
  el.querySelector('[data-photos]').addEventListener('change', e=>thumbs(e, el.querySelector('[data-prev]')));
  el.querySelector('[data-issues]').addEventListener('change', e=>thumbs(e, el.querySelector('[data-prev-issues]')));
});
function thumbs(e, box){ box.innerHTML=''; [...e.target.files].forEach(f=>{ const t=document.createElement('span'); t.className='thumb'; t.textContent='üì∑ '+f.name; box.appendChild(t);}); }
$('#edl_sign').addEventListener('click', openModal);
$('#edl_pdf').addEventListener('click',()=>window.print());

/* ====== QUITTANCE ====== */
function qData(){ return { m:$('#q_month').value, t:$('#q_tenant').value, a:$('#q_addr').value, r:+$('#q_rent').value||0, c:+$('#q_chg').value||0, city:$('#q_city').value }; }
$('#q_make').addEventListener('click',()=>{ const q=qData(); if(!q.m||!q.t||!q.a){ $('#q_out').textContent='Renseignez au minimum P√©riode, Locataire, Adresse.'; return; }
  const tot=q.r+q.c; $('#q_out').innerHTML=`
  <div class="notice">
    <b>QUITTANCE DE LOYER</b><br>
    P√©riode : ${q.m} ‚Äî Locataire : ${q.t}<br>
    Logement : ${q.a}<br>
    D√©tail : Loyer HC ${eur(q.r)} + Charges ${eur(q.c)} = <b>${eur(tot)}</b><br>
    Atteste du paiement int√©gral des sommes dues pour la p√©riode susmentionn√©e.<br>
    ${q.city||''}
  </div>`; try{localStorage.setItem('mbz_quittance',JSON.stringify(q));}catch{} });
$('#q_print').addEventListener('click',()=>window.print());

/* ====== Contact (d√©mo) ====== */
$('#c_send').addEventListener('click',()=>{ const n=$('#c_name').value||'[Nom]'; const m=$('#c_mail').value||'[Email]'; const t=$('#c_msg').value||'[Message]';
  $('#c_out').textContent=`Merci ${n} ‚Äî message enregistr√© en local (d√©mo).`; try{ localStorage.setItem('mbz_contact', JSON.stringify({n,m,t,at:new Date().toISOString()})); }catch{} });
</script>
</body>
</html>
